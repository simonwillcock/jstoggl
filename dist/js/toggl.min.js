/**
 ** JSToggl - An API wrapper to simplify interactions with the Toggl API
 ** @author Simon Willcock <simon@willcock.com.au>
 ** @version v0.1.1
 **/

var TogglClient=function(e,t){var r={clientName:"Toggl JS Client",baseUrl:"https://www.toggl.com/api/",apiVersion:"v8"},n=function(e,t){if(!e)throw new Error("You must provide your API token to use the Toggl API");r.auth="Basic "+btoa(e+":api_token"),"undefined"==typeof t||"undefined"==typeof t.defaultWorkspace?d.all().then(function(e){r.defaultWorkspace=e[0].id}):r.defaultWorkspace=t.defaultWorkspace},i={url:function(){return s("clients")},create:function(e){var t={client:{name:e,wid:r.defaultWorkspace}},n=f(s("clients"),"POST",JSON.stringify(t));return n},get:function(e){var t=f(s("clients",e));return t},update:function(e,t){var n={client:{name:t,wid:r.defaultWorkspace}},i=f(s("clients",e),"PUT",JSON.stringify(n));return i},del:function(e){var t=f(s("clients",e),"DELETE");return t},getProjects:function(e){var t=f(s("clients",e,"projects"));return t},visible:function(){var e=f(s("clients"));return e}},u={url:function(){return s("projects")},create:function(e){var t={project:{name:e,wid:r.defaultWorkspace}},n=f(s("projects"),"POST",JSON.stringify(t));return n},get:function(e){var t=f(s("projects",e));return t},update:function(e,t){var n={project:{name:t,wid:r.defaultWorkspace}},i=f(s("projects",e),"PUT",JSON.stringify(n));return i},del:function(e){var t=f(s("projects",e),"DELETE");return t},getUsers:function(e){var t=f(s("projects",e,"/project_users"));return t},getTasks:function(e){var t=f(s("projects",e,"/tasks"));return t}},a={url:function(){return s("tags")},create:function(e){var t={tag:{name:e,wid:r.defaultWorkspace}},n=f(s("tags"),"POST",JSON.stringify(t));return n},update:function(e,t){var n={tag:{name:t,wid:r.defaultWorkspace}},i=f(s("tags",e),"PUT",JSON.stringify(n));return i},del:function(e){var t=f(s("tags",e),"DELETE");return t}},o={url:function(){return s("timer_entries")},all:function(){var e=f(s("time_entries"));return e},current:function(){var e=f(s("time_entries/current"));return e},create:function(e){for(var t=["start","duration"],n={wid:r.defaultWorkspace,created_with:r.clientName},i={time_entry:$.extend({},n,e)},u=t.length-1;u>=0;u--)if(void 0===typeof i.time_entry[t[u]])throw new Error("Missing required field: "+t[u]);var a=f(s("time_entries"),"POST",JSON.stringify(i));return a},start:function(e){var t={wid:r.defaultWorkspace,created_with:r.clientName},n={time_entry:$.extend({},t,e)},i=f(s("time_entries/start"),"POST",JSON.stringify(n));return i},stop:function(e){var t=f(s("time_entries",e,"stop"),"PUT");return t},get:function(e){var t=f(s("time_entries",e));return t},update:function(e,t){var n={wid:r.defaultWorkspace,created_with:r.clientName},i={time_entry:$.extend({},n,t)},u=f(s("time_entries",e),"PUT",JSON.stringify(i));return u},del:function(e){var t=f(s("time_entries",e),"DELETE");return t},between:function(e,t){throw new Error("Timer.getBetween not yet implemented")}},c={url:function(){return s("me")},current:function(e){var t="me";e===!0&&(t+="?with_related_data=true");var r=f(s(t));return r}},s=function(e,t,n){return r.baseUrl+r.apiVersion+"/"+e+("undefined"!=typeof n&&"undefined"!=typeof t?"/"+t+"/"+n:"undefined"==typeof n&&"undefined"!=typeof t?"/"+t:"undefined"==typeof t&&"undefined"!=typeof n?"/"+n:"")},f=function(e,t,n){var i={Authorization:r.auth};"undefined"==typeof t&&"undefined"==typeof n?t="GET":"undefined"==typeof t&&"undefined"!=typeof n&&(t="POST");var u=$.Deferred();return $.ajax({url:e,type:t,headers:i,data:n,dataType:"json",contentType:"application/json",success:function(e){u.resolve(e)},error:function(e){u.reject(e)}}),u.promise()},d={url:function(){return s("workspaces")},get:function(e){var t=f(s("workspaces",e));return t},all:function(){var e=f(s("workspaces"));return e}};return n(e,t),{timers:o,users:c,projects:u,tags:a,clients:i}};